<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 2 页 | Recording</title>
  <meta name="author" content="jibing57">
  
  <meta name="description" content="AWS, 阅读, Architecture, PostgreSQL">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Recording"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/bootstrap.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/comment.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>
  
  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-111771042-1', 'auto');
  ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?59d3e14cdc96877383afed646f44d216";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>

 <body>  
  <nav id="main-nav" class="navbar  navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">Recording</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/books" title="Douban">
			  <i class="fa fa-book"></i>Douban
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header ">
  <h1 class="title ">Recording, Sharing, TimeSaving -- 一切成本皆时间</h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
      <i class="fa fa-heart"></i>
      Study hard and make progress every day!
</div>    
		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
        <!-- render top articles firstly -->
        
        <!-- render other articles -->
        
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-06-14 </div>
			<div class="article-title"><a href="/2020/06/14/docker-basic/" >Docker基础</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h2 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h2><h3 id="Docker安装-CentOS-7"><a href="#Docker安装-CentOS-7" class="headerlink" title="Docker安装(CentOS 7)"></a>Docker安装(CentOS 7)</h3><p>Docker在CentOS 7上的安装，直接参考官网安装手册即可: <a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="external">Install Docker Engine on CentOS</a></p>
<p>安装Dockerd主版本的步骤如下，要按照特定版本的，参考Docker官网。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">sudo yum -y install epel-release</div><div class="line">sudo yum install -y yum-utils</div><div class="line">sudo yum-config-manager     --add-repo     https://download.docker.com/linux/centos/docker-ce.repo</div><div class="line"># sudo yum list docker-ce --showduplicates | sort -r</div><div class="line">sudo yum -y install docker-ce docker-ce-cli containerd.io -y</div><div class="line">sudo systemctl start docker</div><div class="line">systemctl enable docker</div></pre></td></tr></table></figure></p>
<p>执行<code>docker version</code>来验证docker是否正常安装。</p>
<p>Tips:<br>也可以换用阿里云的docker镜像源<code>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</code></p>
	
	</div>
  <a type="button" href="/2020/06/14/docker-basic/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-06-09 </div>
			<div class="article-title"><a href="/2020/06/09/some-new-nginx-config/" >一些常用的Nginx+Passenger配置</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>摘记一些常用的nginx和passenger(Passenger + Nginx)配置</p>
<h2 id="Basic验证"><a href="#Basic验证" class="headerlink" title="Basic验证"></a>Basic验证</h2><p>测试环境的服务要放到互联网上时，如果为了避免测试服务的内容被搜索引擎收录，或者只提供给部分用户试用时，可以设置Basic Auth来限制访问。Basic Auth可以在应用层做，也可以在Nginx侧简单的设置。</p>
<p>如下是Nginx侧的设置方法, 摘录自Nginx官网文章<a href="https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-http-basic-authentication/" target="_blank" rel="external">Restricting Access with HTTP Basic Authentication</a></p>
<h3 id="设置htpasswd"><a href="#设置htpasswd" class="headerlink" title="设置htpasswd"></a>设置htpasswd</h3><ol>
<li>确保apache2-utils (Debian, Ubuntu) 或者 httpd-tools (RHEL/CentOS/Oracle Linux)已经安装。</li>
<li><p>创建htpasswd文件, 使用<code>-c</code>来创建新文件。如下是给用户名carl生成.htpasswd文件，在提示信息中输入访问密码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ sudo htpasswd -c /etc/nginx/.htpasswd carl</div><div class="line">New password:</div><div class="line">Re-type new password:</div><div class="line">Adding password for user carl</div><div class="line">$</div></pre></td></tr></table></figure>
</li>
<li><p>如果要创建新的用户，那么去掉<code>-c</code>参数，往htpasswd文件中添加用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ sudo htpasswd /etc/nginx/.htpasswd shen</div><div class="line">New password:</div><div class="line">Re-type new password:</div><div class="line">Adding password for user shen</div><div class="line">$</div></pre></td></tr></table></figure>
</li>
<li><p>确认.htpasswd文件中是否包含了刚设置的用户carl和shen</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ cat /etc/nginx/.htpasswd</div><div class="line">carl:$apr1$ofR4vRu4$RwMK.HQawTD8/v.YOA2/d.</div><div class="line">shen:$apr1$c1vlrfgt$TqDy9JDsNcGyfTzcSOPLG0</div><div class="line">$</div></pre></td></tr></table></figure>
</li>
</ol>
	
	</div>
  <a type="button" href="/2020/06/09/some-new-nginx-config/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-06-06 </div>
			<div class="article-title"><a href="/2020/06/06/screen-overview-of-ak-tech/" >屏幕知识概观</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>前几天看到了一个讲解显示器显示技术的科普视频，感觉蛮不错的。摘录了一些内容如下。</p>
<p>视频playlist链接: </p>
<ul>
<li>Youtube - <a href="https://www.youtube.com/playlist?list=PLqybz7NWybwWcl_s-VLB_tXqbbBww6nbK" target="_blank" rel="external">AK‘s Tech Studio - 硬核显示技术系列视频 有关显示器 显示技术和屏幕 一切你需要知道的事</a></li>
<li>B站<ul>
<li><a href="https://www.bilibili.com/video/BV1eV411o76N" target="_blank" rel="external">「硬核显示技术第一期」LCD和OLED的显示原理和优缺点</a></li>
<li><a href="https://www.bilibili.com/video/BV1nf4y1S7EC" target="_blank" rel="external">「硬核显示技术第二期」各种显示器和屏幕的参数 一切你需要知道的</a></li>
<li><a href="https://www.bilibili.com/video/BV1aK4y1k7K5" target="_blank" rel="external">「硬核显示技术第三期」显示器刷新率和FPS详解</a></li>
<li><a href="https://www.bilibili.com/video/BV1N54y1R7wh" target="_blank" rel="external">为什么玩游戏要用高刷新率屏幕「硬核显示技术第四期」</a></li>
<li><a href="https://www.bilibili.com/video/BV1of4y117M8" target="_blank" rel="external">「硬核显示技术第五期」详解一加8Pro的MEMC插帧补偿技术</a></li>
</ul>
</li>
</ul>
	
	</div>
  <a type="button" href="/2020/06/06/screen-overview-of-ak-tech/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-05-31 </div>
			<div class="article-title"><a href="/2020/05/31/how-to-speed-minecraft-launcher-on-macos/" >在MacOS上加速Minecraft Launcher</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h3 id="状况"><a href="#状况" class="headerlink" title="状况"></a>状况</h3><p>周末小朋友在家玩Minecraft，可能是近期网络环境有什么变动。官方启动器下载更新文件特别的慢。十分钟进度条才动了一小格子。</p>
<p>看着进度条好久也不更新，小朋友渐渐地就变得烦躁起来。</p>
<p>我把梯子开了全局代理，重新启动了Minecraft客户端，但貌似没效果。流量压根不从梯子走。</p>
<p>后来自己折腾了一下，找到了一个方法，记录如下:</p>
<h3 id="方法步骤"><a href="#方法步骤" class="headerlink" title="方法步骤"></a>方法步骤</h3><ol>
<li><p>从App中点开Minecraft，然后开启Terminal，找到启动器的进程信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ ps -ef | grep -i minecraft</div><div class="line">  501 11957     1   0  3:45PM ??         0:00.21 /Applications/Minecraft.app/Contents/MacOS/launcher</div><div class="line">  501 11959 11957   0  3:45PM ??         0:01.98 /Applications/Minecraft.app/Contents/Minecraft Updater.app/Contents/MacOS/nativeUpdater --nativePath /Applications/Minecraft.app --nativeStartupPath /Applications/Minecraft.app/Contents --nativeExecutable /Applicati      ons/Minecraft.app/Contents/MacOS/launcher</div><div class="line">  501 12917 12152   0  3:46PM ttys014    0:00.00 ggrep -i minecraft</div><div class="line">$</div></pre></td></tr></table></figure>
</li>
<li><p>在Terminal中启动HTTP proxy(我本地翻墙的proxy端口绑定的是8001端口，可根据实际情况进行修改。)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ export http_proxy=&quot;http://127.0.0.1:8001&quot;; export HTTP_PROXY=&quot;http://127.0.0.1:8001&quot;; export https_proxy=&quot;http://127.0.0.1:8001&quot;; export HTTPS_PROXY=&quot;http://127.0.0.1:8001&quot;</div></pre></td></tr></table></figure>
</li>
<li><p>关闭GUI的启动器界面, 然后手动在Terminal中启动Launcher</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ /Applications/Minecraft.app/Contents/MacOS/launcher</div><div class="line">2020-05-30 15:48:55.733 launcher[14037:45644] Claimed it found a path: /Applications/Minecraft.app/Contents/MacOS/launcher (/Applications/Minecraft.app/Contents/MacOS/launcher) 4096</div><div class="line">https://launchermeta.mojang.com/v1/products/launcher/022631aeac4a9addbce8e0503dce662152dc398d/mac-os.json</div><div class="line">2020-05-30 15:48:58.496 nativeUpdater[14040:45717] Found executable path: /Applications/Minecraft.app/Contents/MacOS/launcher</div><div class="line">2020-05-30 15:48:58.506 nativeUpdater[14040:45717] Found executable path: /Applications/Minecraft.app/Contents/MacOS/launcher</div><div class="line">https://launchermeta.mojang.com/v1/products/launcher/022631aeac4a9addbce8e0503dce662152dc398d/mac-os.json</div></pre></td></tr></table></figure>
</li>
<li><p>此时，也会启动GUI画面的启动器，但是下载文件时，启动器就会走proxy了。</p>
</li>
</ol>

	
	</div>
  <a type="button" href="/2020/05/31/how-to-speed-minecraft-launcher-on-macos/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-05-27 </div>
			<div class="article-title"><a href="/2020/05/27/Add-registry-mirror-to-docker/" >Docker添加国内镜像源</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>在国内访问<a href="https://hub.docker.com/" target="_blank" rel="external">Docker Hub</a>的速度有点慢，换国内源会稳定和快一点。</p>
<h3 id="国内的几个源"><a href="#国内的几个源" class="headerlink" title="国内的几个源:"></a>国内的几个源:</h3><ul>
<li><a href="https://dockerhub.azk8s.cn" target="_blank" rel="external">https://dockerhub.azk8s.cn</a> - Azure镜像</li>
<li><a href="http://hub-mirror.c.163.com" target="_blank" rel="external">http://hub-mirror.c.163.com</a>  - 网易镜像</li>
<li><a href="https://docker.mirrors.ustc.edu.cn" target="_blank" rel="external">https://docker.mirrors.ustc.edu.cn</a> - 科大镜像站</li>
<li><a href="https://registry.docker-cn.com" target="_blank" rel="external">https://registry.docker-cn.com</a> - Docker中国官方镜像 </li>
<li>阿里云也有镜像，只不过需要登录<a href="https://cr.console.aliyun.com/" target="_blank" rel="external">阿里云控制台</a>后获取自己专属的镜像源。</li>
</ul>
<h3 id="设置方法"><a href="#设置方法" class="headerlink" title="设置方法"></a>设置方法</h3><p>参照<a href="https://cloud.google.com/container-registry/docs/using-dockerhub-mirroring" target="_blank" rel="external">Using Container Registry’s Docker Hub mirror</a>这边描述，共有这么几个设置方法</p>
<ol>
<li><p>在配置文件中添加<code>registry-mirrors</code>的配置。启动时自动配置，Linux下的默认配置文件是<code>/etc/docker/daemon.json</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;registry-mirrors&quot;: [&quot;https://&lt;my-docker-mirror-host&gt;&quot;]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>手动启动dockerd的时候，添加<code>--registry-mirror</code>参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dockerd --registry-mirror=https://&lt;my-docker-mirror-host&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
	
	</div>
  <a type="button" href="/2020/05/27/Add-registry-mirror-to-docker/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-05-14 </div>
			<div class="article-title"><a href="/2020/05/14/ruby-rails-tips/" >Ruby &amp; Rails Tips</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h3 id="Struct-amp-OpenStruct"><a href="#Struct-amp-OpenStruct" class="headerlink" title="Struct &amp; OpenStruct"></a>Struct &amp; OpenStruct</h3><h4 id="Struct"><a href="#Struct" class="headerlink" title="Struct"></a>Struct</h4><p>Struct 用于快速声明一个类。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Person = Struct.new(:age, :name, :sex)</div><div class="line">me = Person.new(24, &apos;Spirit&apos;, &apos;male&apos;)</div><div class="line">me.age  # =&gt; 24</div><div class="line">me.name = &apos;Test&apos;</div><div class="line">me.name # =&gt; &apos;Test&apos;</div><div class="line">me.height # =&gt; NoMethodError</div></pre></td></tr></table></figure></p>
<p>优点: 快速声明和实现<br>缺点: 只能响应定义的字段，不能响应任意的属性</p>
<h4 id="OpenStruct"><a href="#OpenStruct" class="headerlink" title="OpenStruct"></a>OpenStruct</h4><p>参考<a href="https://ruby-china.org/topics/21617" target="_blank" rel="external">Ruby Ruby 中的 OpenStruct 详解</a><br>OpenStruct可以自由设置set和get的一个类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">p = OpenStruct.new()</div><div class="line">p.name=&apos;hello&apos;</div><div class="line">p.name  # p.name就是hello</div><div class="line">p.age=12</div><div class="line">p.age   # p.age就是12</div></pre></td></tr></table></figure></p>
<h3 id="skip-before-action"><a href="#skip-before-action" class="headerlink" title="skip before_action"></a>skip before_action</h3><ul>
<li><a href="https://stackoverflow.com/questions/36878355/exclude-a-controller-from-before-action" target="_blank" rel="external">Exclude a controller from before_action</a></li>
</ul>
<h3 id="API接口中使用cookies的方法"><a href="#API接口中使用cookies的方法" class="headerlink" title="API接口中使用cookies的方法"></a>API接口中使用cookies的方法</h3><p>方法一: 在Controller中添加<code>include ActionController::Cookies</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">class ApplicationController &lt; ActionController::API</div><div class="line">  include ActionController::Cookies</div></pre></td></tr></table></figure>
<p>在Controller中就可以访问到cookies变量了。</p>
<p>方法二: 如果不想引入过多的方法，可以在Controller中定义cookies方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">def cookies</div><div class="line">  # helpers not available in --api mode</div><div class="line">  request.cookie_jar</div><div class="line">end</div></pre></td></tr></table></figure></p>
<h3 id="Rails-4中memory-store缓存的使用"><a href="#Rails-4中memory-store缓存的使用" class="headerlink" title="Rails 4中memory_store缓存的使用"></a>Rails 4中memory_store缓存的使用</h3><p>Rails 4中<code>memory_store</code>类型的基础用法</p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>需要在<code>config/environments/development.rb</code>或者<code>config/environments/production.rb</code>中设置开启cache</p>
<ul>
<li><code>config.action_controller.perform_caching</code>设置为true</li>
<li><code>config.cache_store</code>设置为<code>:memory_store</code></li>
</ul>
<h4 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h4><p>所有方法参考: <a href="https://api.rubyonrails.org/v4.0.13/classes/ActiveSupport/Cache/Store.html" target="_blank" rel="external">ActiveSupport::Cache::Store on Ruby on Rails 4.0.13</a></p>
<ul>
<li><p>写入Cache,使用<code>Rails.cache.write</code>，使用<code>expires_in</code>来设置过期时间，不设置的话默认不过期。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Rails.cache.write(cache_key, 10 ,expires_in: 10.seconds)</div></pre></td></tr></table></figure>
</li>
<li><p>读取Cache, 使用<code>Rails.cache.read</code>,传入key，读取value</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Rails.cache.read(cache_key)</div></pre></td></tr></table></figure>
</li>
<li><p>获取Cache对象,使用<code>Rails.cache.send</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Rails.cache.send(:read_entry, cache_key,&#123;&#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>增加Cache中integer类型的值, 使用<code>Rails.cache.increment</code>, 注意这边如果不设置<code>expires_in</code>，则该条目就不再过期，无论原先记录write时有没有设置过期时间。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Rails.cache.increment(cache_key,1, expires_in: 10.seconds)</div></pre></td></tr></table></figure>
</li>
<li><p>读取Cache，如果没有就获取内容后插入, 使用<code>Rails.cache.fetch</code></p>
<ul>
<li>fetch不加block，就相当于read</li>
<li>fetch加了block，那么如果要获取的cache不存在，就会将block中的值添加到cache中，并返回。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Rails.cache.fetch(&apos;test_key&apos;) do</div><div class="line">  &apos;hello world&apos;</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>上述几个命令操作过程的记录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">2.3.8 :135 &gt;   cache_key=&apos;test_key&apos;</div><div class="line"> =&gt; &quot;test_key&quot;</div><div class="line">2.3.8 :136 &gt; Rails.cache.write(cache_key, 10 ,expires_in: 10.seconds)</div><div class="line"> =&gt; true</div><div class="line">2.3.8 :137 &gt; Rails.cache.send(:read_entry, cache_key,&#123;&#125;)</div><div class="line"> =&gt; #&lt;ActiveSupport::Cache::Entry:0x00007fbfa8151750 @value=10, @created_at=1603420143.660662, @expires_in=10.0&gt;</div><div class="line">2.3.8 :138 &gt; Rails.cache.read(cache_key)</div><div class="line"> =&gt; 10</div><div class="line">2.3.8 :139 &gt; Rails.cache.increment(cache_key,1, expires_in: 10.seconds)</div><div class="line"> =&gt; 11</div><div class="line">2.3.8 :140 &gt; Rails.cache.read(cache_key)</div><div class="line"> =&gt; 11</div><div class="line">2.3.8 :141 &gt; Rails.cache.send(:read_entry, cache_key,&#123;&#125;)</div><div class="line"> =&gt; #&lt;ActiveSupport::Cache::Entry:0x00007fbfa9003f78 @value=11, @created_at=1603420143.666131, @expires_in=10.0&gt;</div><div class="line">2.3.8 :142 &gt;</div></pre></td></tr></table></figure></p>
<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><ul>
<li><a href="https://api.rubyonrails.org/v4.0.13/classes/ActiveSupport/Cache/Store.html" target="_blank" rel="external">ActiveSupport::Cache::Store on Ruby on Rails 4.0.13</a></li>
<li><a href="https://stackoverflow.com/questions/22379157/rails-cache-fetch-vs-cache-read-write" target="_blank" rel="external">Rails: cache.fetch vs cache.read/write</a></li>
<li><a href="https://stackoverflow.com/questions/39868775/get-expiration-time-of-rails-cached-item" target="_blank" rel="external">Get expiration time of Rails cached item</a></li>
</ul>

	
	</div>
  <a type="button" href="/2020/05/14/ruby-rails-tips/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-05-04 </div>
			<div class="article-title"><a href="/2020/05/04/imageMagick-fonts-issue-on-Aliyun-Linux-2/" >Aliyun Linux 2上imageMagick的fonts配置问题</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><p>公司阿里云服务器部署Rails程序时，发现Gem <a href="https://github.com/pludoni/simple-captcha" target="_blank" rel="external">simple_captcha2</a>生成的验证码图片，和以前的不太一样。图片中的数字会比正常情况下靠上很多, 影响用户体验。</p>
<p>正常情况下的图片:<br><img src="/images/ImageMagick/fonts_normal.jpeg" alt="fonts_normal.jpeg"></p>
<p>有问题的图片:<br><img src="/images/ImageMagick/fonts_crooked_image.jpeg" alt="crooked_image.jpeg"></p>
<h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>Aliyun Linux 2(也包含最新的CentOS 7)中升级了ImageMagick的版本到<code>ImageMagick 6.9.10-68</code>, 字体配置文件<code>/etc/ImageMagick-6/type.xml</code>中默认改用了<code>urw-base35-fonts</code>，而不是之前的<code>ghostscript-fonts</code>。</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>安装并修改ImageMagick使用旧字体。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># 安装urw-base35-fonts-legacy, fonts在/usr/share/X11/fonts/urw-fonts目录下</div><div class="line">yum install urw-base35-fonts-legacy</div><div class="line"></div><div class="line"># 修改/etc/ImageMagick-6/type.xml配置文件为使用type-ghostscript.xml</div><div class="line">sed -i.bak &apos;s,type-urw-base35.xml,type-ghostscript.xml,g&apos; /etc/ImageMagick-6/type.xml</div><div class="line"></div><div class="line"># 修改 /etc/ImageMagick-6/type-ghostscript.xml为/usr/share/X11/fonts/urw-fonts/</div><div class="line">sed -i.bak &apos;s,metrics=&quot;,metrics=&quot;/usr/share/X11/fonts/urw-fonts/,g&apos; /etc/ImageMagick-6/type-ghostscript.xml</div><div class="line">sed -i &apos;s,glyphs=&quot;,glyphs=&quot;/usr/share/X11/fonts/urw-fonts/,g&apos; /etc/ImageMagick-6/type-ghostscript.xml</div></pre></td></tr></table></figure>
	
	</div>
  <a type="button" href="/2020/05/04/imageMagick-fonts-issue-on-Aliyun-Linux-2/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-04-29 </div>
			<div class="article-title"><a href="/2020/04/29/Install-Postgresql-and-Nodejs-on-Aliyun-Linux-2/" >在Aliyun Linux 2上安装Postgresql和Node.js</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>Aliyun Linux 2上部署环境，遇到了几个问题。记录如下。</p>
<h3 id="安装Postgresql-11-client"><a href="#安装Postgresql-11-client" class="headerlink" title="安装Postgresql 11 client"></a>安装Postgresql 11 client</h3><h4 id="官方Guide"><a href="#官方Guide" class="headerlink" title="官方Guide"></a>官方Guide</h4><ul>
<li>Postgresql官方在红帽系Linux的安装Guide地址: <a href="https://www.postgresql.org/download/linux/redhat/" target="_blank" rel="external">https://www.postgresql.org/download/linux/redhat/</a></li>
<li>Guide中选取对应操作系统后，可以得到Postgresql在RHEL 7系列上的yum源地址是: <a href="https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm" target="_blank" rel="external">https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm</a></li>
</ul>
<p>在RHEL 7系列上安装方法为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum install https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm</div><div class="line">yum install postgresql11</div></pre></td></tr></table></figure>
<h4 id="Aliyun-Linux-2安装问题"><a href="#Aliyun-Linux-2安装问题" class="headerlink" title="Aliyun Linux 2安装问题"></a>Aliyun Linux 2安装问题</h4><p>但该方法在Alinux Linux 2上没法成功安装，因为官方源依赖于yum的变量$releasever,$basearch。在Aliyun Linux 2中，这些变量和RHEL和CentOS上不相同。导致没法直接用官方rpm yum包来安装postgresql11。</p>
	
	</div>
  <a type="button" href="/2020/04/29/Install-Postgresql-and-Nodejs-on-Aliyun-Linux-2/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-04-09 </div>
			<div class="article-title"><a href="/2020/04/09/replace-douban-book-plugin/" >豆瓣插件替换</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>原先使用的<a href="https://github.com/Yikun/hexo-generator-douban" target="_blank" rel="external">Yikun/hexo-generator-douban</a>在豆瓣封了API之后，就彻底没法用了。另外一个插件<a href="https://github.com/mythsman/hexo-douban" target="_blank" rel="external">mythsman/hexo-douban</a>是靠解析网页来生成读书列表，还能工作。就决定换用<a href="https://github.com/mythsman/hexo-douban" target="_blank" rel="external">mythsman/hexo-douban</a>来生成读书列表。<br>以下记录插件替换的过程。</p>
<h3 id="配置变更"><a href="#配置变更" class="headerlink" title="配置变更"></a>配置变更</h3><h4 id="hexo的配置-config-yml"><a href="#hexo的配置-config-yml" class="headerlink" title="hexo的配置_config.yml"></a>hexo的配置<code>_config.yml</code></h4><p>原先为:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">douban:</div><div class="line">  user: jibing57</div></pre></td></tr></table></figure></p>
<p>修改为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">douban:</div><div class="line">  user: jibing57 </div><div class="line">  builtin: false</div><div class="line">  book:</div><div class="line">    title: &apos;豆瓣读书记录&apos;</div><div class="line">    quote: &apos;不完全的读书记录，因为好久才会想起要去豆瓣去点亮一下。&apos;</div><div class="line">  timeout: 10000</div></pre></td></tr></table></figure></p>
	
	</div>
  <a type="button" href="/2020/04/09/replace-douban-book-plugin/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-02-29 </div>
			<div class="article-title"><a href="/2020/02/29/how-to-use-rvm-to-instal-ruby-in-slow-network-connection/" >弱网络环境下如何使用rvm安装ruby</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>下面介绍下如何在屏蔽比较严重的网络情况下使用rvm来半手工的安装ruby, 如下操作基于CentOS 7，其他操作系统可能有所不同。</p>
<h3 id="安装rvm"><a href="#安装rvm" class="headerlink" title="安装rvm"></a>安装rvm</h3><h4 id="官网安装步骤"><a href="#官网安装步骤" class="headerlink" title="官网安装步骤"></a>官网安装步骤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gpg --keyserver hkp://pool.sks-keyservers.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB</div><div class="line">curl -L get.rvm.io | bash -s stable</div></pre></td></tr></table></figure>
<h4 id="问题点"><a href="#问题点" class="headerlink" title="问题点:"></a>问题点:</h4><p><code>get.rvm.io</code>是重定向到<code>https://raw.githubusercontent.com/rvm/rvm/master/binscripts/rvm-installer</code>这个地址的。可是有些国内机构的网络中，<code>raw.githubusercontent.com</code>这个域名是被屏蔽的。</p>
<h4 id="措施"><a href="#措施" class="headerlink" title="措施:"></a>措施:</h4><p>可先在本地下载rvm-installer脚本，再拷贝脚本到服务器后，再执行安装命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># 1. 本机上下载</div><div class="line">curl -L get.rvm.io &gt; rvm-installer.sh</div><div class="line"></div><div class="line"># 2. 拷贝rvm-installer.sh到服务器</div><div class="line"></div><div class="line"># 3. 服务器本地执行安装命令</div><div class="line">cat rvm-installer.sh | bash -s stable</div></pre></td></tr></table></figure></p>
	
	</div>
  <a type="button" href="/2020/02/29/how-to-use-rvm-to-instal-ruby-in-slow-network-connection/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">
<ul class="pagination">
	 
		
    	<li class="prev"><a href="/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i> 上一页</a></li>
  		

        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>

		
		   <li class="next"> <a href="/page/3/" class="alignright next">下一页<i class="fa fa-arrow-circle-o-right"></i></a> </li>          
        
	
</ul>
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
<div class="widget">
	<h4>AWS Certification</h4>
    <ul class="blogroll list-unstyled">
    <div class="thumbnail"><a href="/images/AWS/CertificationLogo/AWS_Certified_Logo_Color.png"><img src="/images/AWS/CertificationLogo/AWS_Certified_Logo_Color.png" alt="images"  class="nofancybox"></a>
    </ul>
</div>


		
			<div class="widget">
    
</div>

		
			
	<div class="widget">
		<h4>分类</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/#AWS">AWS<span>37</span></a></li>
		
			<li><a href="/categories/#AWS Certified">AWS Certified<span>4</span></a></li>
		
			<li><a href="/categories/#Blog">Blog<span>6</span></a></li>
		
			<li><a href="/categories/#Code">Code<span>6</span></a></li>
		
			<li><a href="/categories/#Kubernetes">Kubernetes<span>2</span></a></li>
		
			<li><a href="/categories/#Linux">Linux<span>11</span></a></li>
		
			<li><a href="/categories/#Shell">Shell<span>8</span></a></li>
		
			<li><a href="/categories/#Tools">Tools<span>34</span></a></li>
		
			<li><a href="/categories/#杂">杂<span>1</span></a></li>
		
		</ul>
	</div>


		
			
	<div class="widget">
		<h4>标签云</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/#HTTPS">HTTPS<span>1</span></a></li>
		
			<li><a href="/tags/#感悟">感悟<span>1</span></a></li>
		
			<li><a href="/tags/#AWS Tools">AWS Tools<span>2</span></a></li>
		
			<li><a href="/tags/#Passenger">Passenger<span>3</span></a></li>
		
			<li><a href="/tags/#AWS Deep Dive">AWS Deep Dive<span>2</span></a></li>
		
			<li><a href="/tags/#Ubuntu">Ubuntu<span>1</span></a></li>
		
			<li><a href="/tags/#Application Load Balancing">Application Load Balancing<span>1</span></a></li>
		
			<li><a href="/tags/#VMware">VMware<span>2</span></a></li>
		
			<li><a href="/tags/#HLS">HLS<span>2</span></a></li>
		
			<li><a href="/tags/#Udemy">Udemy<span>1</span></a></li>
		
			<li><a href="/tags/#Crontab">Crontab<span>1</span></a></li>
		
			<li><a href="/tags/#Linux">Linux<span>15</span></a></li>
		
			<li><a href="/tags/#DockerHub">DockerHub<span>1</span></a></li>
		
			<li><a href="/tags/#Video">Video<span>1</span></a></li>
		
			<li><a href="/tags/#iPhone">iPhone<span>1</span></a></li>
		
			<li><a href="/tags/#Github">Github<span>4</span></a></li>
		
			<li><a href="/tags/#Elastic Beanstalk">Elastic Beanstalk<span>7</span></a></li>
		
			<li><a href="/tags/#Douban">Douban<span>2</span></a></li>
		
			<li><a href="/tags/#Ruby">Ruby<span>11</span></a></li>
		
			<li><a href="/tags/#Yarn">Yarn<span>1</span></a></li>
		
		
		   <li><a href="/tags">...<span>73</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>最新文章</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2020/10/24/upgrade-postgresql-version-on-aws-RDS/" ><i class="fa fa-file-o"></i>AWS RDS PostgreSQL版本升级</a>
      </li>
    
      <li>
        <a href="/2020/10/22/wkhtmltopdf-to-support-chinese-charactor/" ><i class="fa fa-file-o"></i>wkhtmltopdf支持中文字体</a>
      </li>
    
      <li>
        <a href="/2020/10/14/why-disk-space-not-restored-after-deleting-iphone-backup-on-macos/" ><i class="fa fa-file-o"></i>MacOS下使用iTunes删除iphone备份磁盘空...</a>
      </li>
    
      <li>
        <a href="/2020/08/04/some-tips-of-aws-lightsail/" ><i class="fa fa-file-o"></i>AWS LightSail Tips</a>
      </li>
    
      <li>
        <a href="/2020/08/01/advanced-configure-of-nginx-rtmp/" ><i class="fa fa-file-o"></i>Nginx RTMP服务器配置</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>链接</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="https://github.com/jibing57/" title="My Github repository." target="_blank"]);">My Github</a></li>
	
		<li><i class="fa fa-linkedin"></i><a href="https://www.linkedin.com/in/honggang-shen-37669214a/" title="My Linkin account." target="_blank"]);">My LinkedIn</a></li>
	
		<li><i class="fa fa-rss"></i><a href="/atom.xml" title="rss." target="_blank"]);">RSS</a></li>
	
		<li><i class="fa fa-sitemap"></i><a href="/sitemap.xml" title="Site Map" target="_blank"]);">Site Map</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->


	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2020 jibing57
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
