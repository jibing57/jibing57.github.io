<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Recording</title>
  <meta name="author" content="jibing57">
  
  <meta name="description" content="AWS, 阅读, Architecture, PostgreSQL">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Recording"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/bootstrap.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/comment.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>
  
  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-111771042-1', 'auto');
  ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?59d3e14cdc96877383afed646f44d216";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>

 <body>  
  <nav id="main-nav" class="navbar  navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">Recording</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/books" title="Douban">
			  <i class="fa fa-book"></i>Douban
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header ">
  <h1 class="title ">Recording, Sharing, TimeSaving -- 一切成本皆时间</h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
      <i class="fa fa-heart"></i>
      Study hard and make progress every day!
</div>    
		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
        <!-- render top articles firstly -->
        
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
            
		
        
        <!-- render other articles -->
        
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2021-02-07 </div>
			<div class="article-title"><a href="/2021/02/07/one-record-about-continuous-disk-rise-of-Postgresql/" >Postgresql数据库磁盘快速增长的一个可能原因</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>Postgresql中发现磁盘占用空间莫名快速增长时，有一种可能是因为<code>pg_stat_activity</code>中有异常的很久之前的查询导致的。<br>持续时间特别长的查询会导致Postgresql不停的维护该查询之后所有更新的数据记录，导致表大小快速的膨胀。</p>
<h3 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h3><h4 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h4><p>AWS上一套系统的RDS之前从Postgresql 9.5升级到了9.6。升级之后跑的好好的，突然在1月中接到警报，说磁盘不足。<br>很好奇,这是一个访问量不大的网站, 之前记得一百多个G空间的。怎么突然就警报空间不足了。</p>
<h4 id="调查"><a href="#调查" class="headerlink" title="调查"></a>调查</h4><p>登录AWS Console一看，吓了一跳，RDS的数据库剩余磁盘容量，2个星期内从180G下降到80G。空间下降这么快，肯定是哪边出了问题。<br>使用<code>psql</code>登录后台，查看了各表的大小<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">FROM (</div><div class="line">    SELECT</div><div class="line">        table_name,</div><div class="line">        pg_table_size(table_name) AS table_size,</div><div class="line">        pg_indexes_size(table_name) AS indexes_size,</div><div class="line">        pg_total_relation_size(table_name) AS total_size</div><div class="line">    FROM (</div><div class="line">        SELECT (&apos;&quot;&apos; || table_schema || &apos;&quot;.&quot;&apos; || table_name || &apos;&quot;&apos;) AS table_name</div><div class="line">        FROM information_schema.tables</div><div class="line">    ) AS all_tables</div><div class="line">    ORDER BY total_size DESC</div><div class="line">) AS pretty_sizes</div></pre></td></tr></table></figure></p>
	
	</div>
  <a type="button" href="/2021/02/07/one-record-about-continuous-disk-rise-of-Postgresql/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2021-02-07 </div>
			<div class="article-title"><a href="/2021/02/07/yum-install-exiting-on-user-cancel-on-centos-7-0-1406/" >CentOS 7.0.1406上yum install提示exiting on user cancel错误的解决方法</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>公司一台老CentOS 7机器上要安装某个软件，<code>yum install</code>后，提示安装失败，提示<code>Exiting on user cancel</code>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">File &quot;/usr/libexec/urlgrabber-ext-down&quot;, line 75, in &lt;module&gt;</div><div class="line">main()</div><div class="line">File &quot;/usr/libexec/urlgrabber-ext-down&quot;, line 61, in main</div><div class="line">fo = PyCurlFileObject(opts.url, opts.filename, opts)</div><div class="line">File &quot;/usr/lib/python2.7/site-packages/urlgrabber/grabber.py&quot;, line 1258, in __init__</div><div class="line">self._do_open()</div><div class="line">File &quot;/usr/lib/python2.7/site-packages/urlgrabber/grabber.py&quot;, line 1589, in _do_open</div><div class="line">self._do_grab()</div><div class="line">File &quot;/usr/lib/python2.7/site-packages/urlgrabber/grabber.py&quot;, line 1723, in _do_grab</div><div class="line">self._do_perform()</div><div class="line">File &quot;/usr/lib/python2.7/site-packages/urlgrabber/grabber.py&quot;, line 1517, in _do_perform</div><div class="line">raise KeyboardInterrupt</div><div class="line">KeyboardInterrupt</div><div class="line"></div><div class="line"></div><div class="line">Exiting on user cancel</div></pre></td></tr></table></figure></p>
<p>试了多次都是这样，一脸诧异。<br>查看了下CentOS版本是<code>CentOS Linux release 7.0.1406 (Core)</code>, 网上搜一通，发现是CentOS 7.0.1406中yum的一个Bug。摘录解决方法如下。</p>
	
	</div>
  <a type="button" href="/2021/02/07/yum-install-exiting-on-user-cancel-on-centos-7-0-1406/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2021-01-15 </div>
			<div class="article-title"><a href="/2021/01/15/why-command-c-cannot-copy-on-macos/" >MacOS下复制快捷键失效问题</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>不知道从哪个版本的OSX系统开始，复制快捷键<code>Command + C</code>就开始不怎么灵，有时候按一下复制不成功，需要多按几下才有效。<br>之前网上查找没找到什么可靠的说法。就一直以为是系统的Bug。<br>这么多年已经习惯每次复制时，按两下<code>Command + C</code>了。</p>
<p>直到今天无意间看到公众号上的一个评论，说可能是第三方词典app的划词功能导致的。<br>试了一下，关闭了电脑上欧路词典的划词搜索后，瞬间豁然开朗, <code>Command + C</code>如丝般柔顺，再也没出现过拷贝不生效的情况了。</p>
<p>不禁再次反思自己，懊恼自己这么多年的妥协，16年知乎上就有帖子<a href="https://www.zhihu.com/question/35784714/answer/127996256" target="_blank" rel="external">Mac OS复制粘贴功能经常失效，问题出在哪里？有何解决办法？</a>回答过这个问题了，而我却一直忍受了这个问题到2021年。</p>
<p>相同的一例反思, 也是词典APP导致的不兼容: <a href="/2019/10/31/why-format-painter-not-working-on-mac-office-365/" title="Mac下Word不能双击格式刷重复刷的问题">Mac下Word不能双击格式刷重复刷的问题</a></p>

	
	</div>
  <a type="button" href="/2021/01/15/why-command-c-cannot-copy-on-macos/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-11-11 </div>
			<div class="article-title"><a href="/2020/11/11/how-to-let-nginx-process-request-header-with-dots/" >如何让Nginx支持带点的header</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h3 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h3><p>公司有个比较久远的遗留APP项目，服务端用的是之前公司自己写的一个HTTP的服务器。最近这个项目被要求升级使用https。<br>但自研的HTTP服务器自身不支持https, 老代码了也已经没人没精力去再开发了。<br>一合计，就决定在前面架一个Nginx来做反向代理，用来终止SSL再转发请求给自写的HTTP服务器。</p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>咵咵咵，三下五除二，申请了https证书，配置了nginx，项目就跑起来了。<br>可测试阶段，发现有个别请求会失败。一检查，发现是服务端接收到的请求中，有一个Header的值没有获取到。</p>
<h3 id="结果过程"><a href="#结果过程" class="headerlink" title="结果过程"></a>结果过程</h3><p>挠了挠头皮，调查了下。发现这个自定义的header比较奇怪，名字中带有<code>.</code>, 类似<code>user.token</code>。<br>上网一通找，找到几个文章</p>
<ul>
<li><a href="https://forum.nginx.org/read.php?2,44453,44453#msg-44453" target="_blank" rel="external">Having dot in the header name</a></li>
<li><a href="https://trac.nginx.org/nginx/ticket/629" target="_blank" rel="external">Nginx as a reverse proxy will not pass headers that contain a period.</a></li>
</ul>
<p>大意就是虽然RFC中没有规定带<code>.</code>的header是非法的，但Nginx默认就是不支持带<code>.</code>的header的。如果需要支持，可以考虑使用<a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#ignore_invalid_headers" target="_blank" rel="external">ignore_invalid_headers</a>来实现。<br>尝试着修改了nginx配置，添加了<code>ignore_invalid_headers off;</code>后, 解决了该问题。</p>
<h3 id="云厂商负载均衡服务的行为"><a href="#云厂商负载均衡服务的行为" class="headerlink" title="云厂商负载均衡服务的行为"></a>云厂商负载均衡服务的行为</h3><h4 id="Cloudflare"><a href="#Cloudflare" class="headerlink" title="Cloudflare"></a>Cloudflare</h4><p>Cloudflare会丢弃带<code>.</code>的header</p>
<blockquote>
<p>Cloudflare strips any header that contains dots (.) from origin web server responses. For example, the origin web server header test.header:data is removed by Cloudflare’s proxy.<br>来自: <a href="https://support.cloudflare.com/hc/en-us/articles/200170986-How-does-Cloudflare-handle-HTTP-Request-headers-" target="_blank" rel="external">How does Cloudflare handle HTTP Request headers?</a></p>
</blockquote>
<h4 id="AWS"><a href="#AWS" class="headerlink" title="AWS"></a>AWS</h4><p>待调查，参考资料</p>
<ul>
<li><a href="https://forums.aws.amazon.com/thread.jspa?messageID=923182" target="_blank" rel="external">ALB removes header “access_token” from incoming request</a></li>
</ul>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="https://trac.nginx.org/nginx/ticket/629" target="_blank" rel="external">Nginx as a reverse proxy will not pass headers that contain a period.</a></li>
<li><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#ignore_invalid_headers" target="_blank" rel="external">ignore_invalid_headers</a></li>
<li><a href="https://forum.nginx.org/read.php?2,44453,44453#msg-44453" target="_blank" rel="external">Having dot in the header name</a></li>
</ul>

	
	</div>
  <a type="button" href="/2020/11/11/how-to-let-nginx-process-request-header-with-dots/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-11-07 </div>
			<div class="article-title"><a href="/2020/11/07/build-k8s-cluster-with-kubeadm-on-centos7/" >在CentOS 7中使用kubeadm搭建kubernetes集群</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>在CentOS 7上使用kubeadm安装kubernetes cluster的方法。</p>
<h3 id="安装公共组件"><a href="#安装公共组件" class="headerlink" title="安装公共组件"></a>安装公共组件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo yum install -y wget net-tools vim</div></pre></td></tr></table></figure>
<h3 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h3><p>CentOS 7中安装docker参见之前文章<a href="/2020/06/14/docker-basic/" title="Docker基础">Docker基础</a></p>
<h3 id="安装Kubernetes"><a href="#安装Kubernetes" class="headerlink" title="安装Kubernetes"></a>安装Kubernetes</h3><h4 id="添加kubenetes的yum源"><a href="#添加kubenetes的yum源" class="headerlink" title="添加kubenetes的yum源"></a>添加kubenetes的yum源</h4><p>在Master和Node中同时添加阿里云的yum源。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">sudo cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</div><div class="line">[kubernetes]</div><div class="line">name=Kubernetes</div><div class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</div><div class="line">enabled=1</div><div class="line">gpgcheck=1</div><div class="line">repo_gpgcheck=1</div><div class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</div><div class="line">EOF</div></pre></td></tr></table></figure></p>
	
	</div>
  <a type="button" href="/2020/11/07/build-k8s-cluster-with-kubeadm-on-centos7/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-10-24 </div>
			<div class="article-title"><a href="/2020/10/24/upgrade-postgresql-version-on-aws-RDS/" >AWS RDS PostgreSQL版本升级</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h3 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h3><p>海外AWS中有一套系统采用的是PostgreSQL 9.5， 因为PG 9.5在2021年2月11号之后不再被PG社区所支持了, PG社区对版本的支持参见<a href="https://www.postgresql.org/support/versioning/" target="_blank" rel="external">Versioning Policy</a>。因此AWS发送了邮件，提示我们尽快升级到9.6。并且介于PG 9.6在2020年11月11号之后也会停止支持，AWS建议直接升级到PostgreSQL 12或以上版本。 </p>
<p>基于直接从9.5升级到12，中间跨越版本太大，可能会有问题。因此决定先暂时升级到9.6。等后续完整测试12后，再升级到12。</p>
<h3 id="升级步骤"><a href="#升级步骤" class="headerlink" title="升级步骤"></a>升级步骤</h3><p>AWS升级，可以在Web Console中点击几个按钮就可以升级。但升级时，Event提示升级失败，PreUpgrade checks Fails。报错如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">The instance could not be upgraded from 9.5.22.R1 to 9.6.19.R1 because of following reasons. Please take appropriate action on databases that have usages incompatible with requested major engine version upgrade and try again.</div><div class="line"></div><div class="line">Following usages in database &apos;xxxxx&apos; need to be corrected before upgrade:</div><div class="line">-- The instance could not be upgraded because there are one or more databases with an older version of PostGIS extension or its dependent extensions (address_standardizer, address_standardizer_data_us, postgis_tiger_geocoder, postgis_topology) installed. Please upgrade all installations of PostGIS and drop its dependent extensions and try again.</div><div class="line">Following usages in database &apos;nest_demo&apos; need to be corrected before upgrade:</div></pre></td></tr></table></figure></p>
<p>提示升级检查失败，原因是<code>PostGIS</code>的版本存在问题。</p>
	
	</div>
  <a type="button" href="/2020/10/24/upgrade-postgresql-version-on-aws-RDS/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-10-22 </div>
			<div class="article-title"><a href="/2020/10/22/wkhtmltopdf-to-support-chinese-charactor/" >wkhtmltopdf支持中文字体</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>CentOS 7.8环境中，要使用wkhtmltopdf来从网页中生成PDF。<br>没有使用rpm包来安装wkhtmltopdf命令，而是使用了<code>gem &#39;wkhtmltopdf-binary&#39;</code>在Rails项目下安装了<code>wkhtmltopdf</code></p>
<p>运行后发现，网页中的中文在PDF中没法显示。</p>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>调查后发现是因为系统中缺少中文字体的支持，使用如下命令安装字体后，可以解决。两者选其一。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo yum install -y wqy-microhei-fonts</div><div class="line"># 或者</div><div class="line">sudo yum install -y xorg-x11-fonts-75dpi</div></pre></td></tr></table></figure>
	
	</div>
  <a type="button" href="/2020/10/22/wkhtmltopdf-to-support-chinese-charactor/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-10-14 </div>
			<div class="article-title"><a href="/2020/10/14/why-disk-space-not-restored-after-deleting-iphone-backup-on-macos/" >MacOS下使用iTunes删除iphone备份磁盘空间没回收</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<p>记一次有趣的经历。</p>
<h3 id="事情经过"><a href="#事情经过" class="headerlink" title="事情经过"></a>事情经过</h3><p>为了能用Watch 6，升级了手机系统到IOS 14。升级之前在电脑上用itunes备份了下(<strong>没错，是itunes，我mac系统还在用10.14,所以还是itunes,不是Finder</strong>)，占了几十个G的空间，电脑上磁盘空间一下子紧张了。手机升级完毕后，看了下没啥问题，就准备把电脑上的iphone备份给删了。</p>
<p>以前删备份都是打开Terminal, 进入<code>~/Library/Application\ Support/MobileSync/Backup/</code>后手动<code>rm -r xxx</code>的。可这次不知道为啥，鬼使神差的用了itunes自带的删除备份的功能。就是下面这个界面。</p>
<p><img src="/images/Apple/device_backup_on_itunes.jpg" alt="device_backup_on_itunes.jpg"></p>
<p>一通操作，在界面上把备份删除了。</p>
<p>然后信心满满地敲下了<code>df -h</code>来查看回收了多少磁盘空间。</p>
<p>命令一敲，啥情况。怎么空间没有被回收？</p>
<p>猜想，可能是itune的Bug，文件没有被删除吧。算了算了，还是手动删一下吧。打开Terminal，潇洒的敲击<code>cd ~/Library/Application\ Support/MobileSync/Backup/</code>，熟练的敲击<code>du -sh ./*</code>来查看是哪个目录没有被回收。</p>
<p>一敲下去，发现不对劲，怎么显示Backup占用的磁盘空间是0B?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ du -sh ./*</div><div class="line">  0B	./00008020-000464E03BD8002E</div><div class="line">$</div></pre></td></tr></table></figure>
	
	</div>
  <a type="button" href="/2020/10/14/why-disk-space-not-restored-after-deleting-iphone-backup-on-macos/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-08-04 </div>
			<div class="article-title"><a href="/2020/08/04/some-tips-of-aws-lightsail/" >AWS LightSail Tips</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h3 id="如何跨区域迁移LightSail"><a href="#如何跨区域迁移LightSail" class="headerlink" title="如何跨区域迁移LightSail"></a>如何跨区域迁移LightSail</h3><p>步骤:</p>
<ol>
<li>现在源区域中对LightSail Instance做snapshot</li>
<li>然后对该snapshot进行”Copy to another Region”的操作，选择目标Region进行拷贝</li>
<li>在目标Region中选择拷贝来的snapshot，选择”Create new instance”</li>
</ol>
<p>官网介绍操作的两篇文章, 清晰易懂。</p>
<ul>
<li><a href="https://lightsail.aws.amazon.com/ls/docs/en_us/articles/amazon-lightsail-copying-snapshots-from-one-region-to-another" target="_blank" rel="external">Copying snapshots from one AWS Region to another in Amazon Lightsail</a></li>
<li><a href="https://lightsail.aws.amazon.com/ls/docs/en_us/articles/lightsail-how-to-create-instance-from-snapshot" target="_blank" rel="external">Creating an instance from a manual snapshot in Amazon Lightsail</a></li>
</ul>
<h3 id="LightSail"><a href="#LightSail" class="headerlink" title="LightSail"></a>LightSail</h3><p>和EC2 Instance不同，LightSail在stopped状态时也是会收费的。参照<a href="https://aws.amazon.com/lightsail/faq/" target="_blank" rel="external">官方fAQ</a></p>
<blockquote>
<p><strong>Q: When am I getting charged for a plan?</strong></p>
<p>Your Lightsail instances are charged only when they’re in the running or stopped state. If you delete your Lightsail instance before the end of the month, we only charge you a prorated cost, based on the total number of hours that you used your Lightsail instance. For example, if you use the least expensive Lightsail plan for 100 hours in a month, you will be charged 47 cents (100*0.0047).</p>
</blockquote>
<p><a href="https://blog.skeddly.com/2017/01/understanding-lightsail-pricing.html#:~:text=Your%20Lightsail%20instances%20are%20charged,you%20used%20your%20Lightsail%20instance." target="_blank" rel="external">Understanding Lightsail Pricing</a>这个文章还介绍了LightSail的计费方式。</p>
	
	</div>
  <a type="button" href="/2020/08/04/some-tips-of-aws-lightsail/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		
           
			  
	
	<!-- display as entry -->	
		<h3 class="title">
			<div class="date"> 2020-08-01 </div>
			<div class="article-title"><a href="/2020/08/01/advanced-configure-of-nginx-rtmp/" >Nginx RTMP服务器配置</a></div>						
		</h3>
	


			  <div class="entry">
  <div class="row">
	
	
		<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>本篇是<a href="/2020/07/29/how-to-setup-nginx-rtmp-on-centos-7/" title="CentOS 7中搭建基础的Nginx RMPT服务器">CentOS 7中搭建基础的Nginx RMPT服务器</a>的续篇，记录了Nignx RTMP使用过程中的一些有用的配置和一些坑。<br>下面的内容，是以文章<a href="/2020/07/29/how-to-setup-nginx-rtmp-on-centos-7/" title="CentOS 7中搭建基础的Nginx RMPT服务器">CentOS 7中搭建基础的Nginx RMPT服务器</a>中的配置为基准进行的修改。</p>
<h3 id="配置stat"><a href="#配置stat" class="headerlink" title="配置stat"></a>配置stat</h3><p><a href="https://github.com/arut/nginx-rtmp-module" target="_blank" rel="external">nginx-rtmp-module</a>自身提供了统计的功能。按照Github上官方例子进行配置就行。<a href="https://github.com/arut/nginx-rtmp-module" target="_blank" rel="external">https://github.com/arut/nginx-rtmp-module</a><br>首先，拷贝<a href="https://github.com/arut/nginx-rtmp-module" target="_blank" rel="external">nginx-rtmp-module</a>源码中的stat.xls到nginx默认主目录<code>/usr/local/nginx/html/</code>中。<br>再配置rtmp的stat, 在默认server中添加如下配置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># This URL provides RTMP statistics in XML</div><div class="line">location /stat &#123;</div><div class="line">    rtmp_stat all;</div><div class="line"></div><div class="line">    # Use this stylesheet to view XML as web page</div><div class="line">    # in browser</div><div class="line">    rtmp_stat_stylesheet stat.xsl;</div><div class="line">&#125;</div><div class="line"></div><div class="line">location /stat.xsl &#123;</div><div class="line">    # XML stylesheet to view RTMP stats.</div><div class="line">    # Copy stat.xsl wherever you want</div><div class="line">    # and put the full directory path here</div><div class="line">    root html;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
	
	</div>
  <a type="button" href="/2020/08/01/advanced-configure-of-nginx-rtmp/#more" class="btn btn-default more">阅读此文</a>
</div>

           
		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">
<ul class="pagination">
	 
		
          <li class="prev disabled"><a><i class="fa fa-arrow-circle-o-left"></i>上一页</a></li>
        

        <li><a href="/"><i class="fa fa-home"></i>Home</a></li>

		
		   <li class="next"> <a href="/page/2/" class="alignright next">下一页<i class="fa fa-arrow-circle-o-right"></i></a> </li>          
        
	
</ul>
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
<div class="widget">
	<h4>AWS Certification</h4>
    <ul class="blogroll list-unstyled">
    <div class="thumbnail"><a href="/images/AWS/CertificationLogo/AWS_Certified_Logo_Color.png"><img src="/images/AWS/CertificationLogo/AWS_Certified_Logo_Color.png" alt="images"  class="nofancybox"></a>
    </ul>
</div>


		
			<div class="widget">
    
</div>

		
			
	<div class="widget">
		<h4>分类</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/#AWS">AWS<span>38</span></a></li>
		
			<li><a href="/categories/#AWS Certified">AWS Certified<span>4</span></a></li>
		
			<li><a href="/categories/#Blog">Blog<span>6</span></a></li>
		
			<li><a href="/categories/#Code">Code<span>6</span></a></li>
		
			<li><a href="/categories/#Kubernetes">Kubernetes<span>3</span></a></li>
		
			<li><a href="/categories/#Linux">Linux<span>12</span></a></li>
		
			<li><a href="/categories/#Shell">Shell<span>8</span></a></li>
		
			<li><a href="/categories/#Tools">Tools<span>36</span></a></li>
		
			<li><a href="/categories/#杂">杂<span>1</span></a></li>
		
		</ul>
	</div>


		
			
	<div class="widget">
		<h4>标签云</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/#Ubuntu">Ubuntu<span>1</span></a></li>
		
			<li><a href="/tags/#CentOS">CentOS<span>16</span></a></li>
		
			<li><a href="/tags/#Tips">Tips<span>1</span></a></li>
		
			<li><a href="/tags/#Yum">Yum<span>2</span></a></li>
		
			<li><a href="/tags/#S3">S3<span>10</span></a></li>
		
			<li><a href="/tags/#Github">Github<span>4</span></a></li>
		
			<li><a href="/tags/#Rails">Rails<span>5</span></a></li>
		
			<li><a href="/tags/#Redis">Redis<span>1</span></a></li>
		
			<li><a href="/tags/#SSH">SSH<span>6</span></a></li>
		
			<li><a href="/tags/#Passenger">Passenger<span>3</span></a></li>
		
			<li><a href="/tags/#iOS">iOS<span>1</span></a></li>
		
			<li><a href="/tags/#FFMPEG">FFMPEG<span>4</span></a></li>
		
			<li><a href="/tags/#Wireshark">Wireshark<span>1</span></a></li>
		
			<li><a href="/tags/#Nginx">Nginx<span>11</span></a></li>
		
			<li><a href="/tags/#Nodejs">Nodejs<span>4</span></a></li>
		
			<li><a href="/tags/#AutoScaling">AutoScaling<span>3</span></a></li>
		
			<li><a href="/tags/#LCD">LCD<span>1</span></a></li>
		
			<li><a href="/tags/#PostgreSQL">PostgreSQL<span>7</span></a></li>
		
			<li><a href="/tags/#Bug">Bug<span>1</span></a></li>
		
			<li><a href="/tags/#Cache">Cache<span>1</span></a></li>
		
		
		   <li><a href="/tags">...<span>75</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>最新文章</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2021/02/07/one-record-about-continuous-disk-rise-of-Postgresql/" ><i class="fa fa-file-o"></i>Postgresql数据库磁盘快速增长的一个可能原因</a>
      </li>
    
      <li>
        <a href="/2021/02/07/yum-install-exiting-on-user-cancel-on-centos-7-0-1406/" ><i class="fa fa-file-o"></i>CentOS 7.0.1406上yum install...</a>
      </li>
    
      <li>
        <a href="/2021/01/15/why-command-c-cannot-copy-on-macos/" ><i class="fa fa-file-o"></i>MacOS下复制快捷键失效问题</a>
      </li>
    
      <li>
        <a href="/2020/11/11/how-to-let-nginx-process-request-header-with-dots/" ><i class="fa fa-file-o"></i>如何让Nginx支持带点的header</a>
      </li>
    
      <li>
        <a href="/2020/11/07/build-k8s-cluster-with-kubeadm-on-centos7/" ><i class="fa fa-file-o"></i>在CentOS 7中使用kubeadm搭建kubern...</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>链接</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="https://github.com/jibing57/" title="My Github repository." target="_blank"]);">My Github</a></li>
	
		<li><i class="fa fa-linkedin"></i><a href="https://www.linkedin.com/in/honggang-shen-37669214a/" title="My Linkin account." target="_blank"]);">My LinkedIn</a></li>
	
		<li><i class="fa fa-rss"></i><a href="/atom.xml" title="rss." target="_blank"]);">RSS</a></li>
	
		<li><i class="fa fa-sitemap"></i><a href="/sitemap.xml" title="Site Map" target="_blank"]);">Site Map</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->


	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2021 jibing57
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
